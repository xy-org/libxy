import xytest;
import libxy.(string, log, fs);

*func logginDefaultConfig~Test() {
    tmpFile := openTmp();
    [Global~Log] = Log {
        file=tmpFile'copy,
    };


    (info) "Info Msg";
    (err) "Err Msg";
    (verbose) "Verbose Msg";

    tmpFile'seek(0);
    (equal) f"{tmpFile}", "Info Msg\nErr Msg\n";
}

*func simpleLogging~Test() {
    tmpFile := openTmp();
    [Global~Log] = Log {
        level=logLevelVerbose,
        file=tmpFile'copy,
    };

    (v) "Verbose Msg1";
    (v) "Verbose Msg2";

    tmpFile'seek(0);
    (equal) f"{tmpFile}", "Verbose Msg1\nVerbose Msg2\n";
}

struct Marker {
    touched : Bool;
}

func append(fstr: mut Fstring, m: mut Marker) {
    m.touched = true;
}

*func msgIsLazy~Test() {
    [Global~Log] = Log {
        file=openTmp(),
    };

    m : mut Marker;
    (debug) f"marker={m}";

    (assert) !m.touched;
}
