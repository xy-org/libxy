import xytest;
import libxy.string;
import ..;

struct Data1 {
    x: Int;
    y: Int;
}

struct Data2 {
    weight: Float;
    age: Int;
}

*func creatingAndAttaching~Test() {
    edb: Ecs;

    entity := edb'entity();
    edb @= (entity, Data1{10, 20});
    (assert) edb'has(entity, Data1);
    (assert) edb'has(entity, Data2)'not;

    edb @= (entity, Data2);
    (assert) edb'has(entity, Data1);
    (assert) edb'has(entity, Data2);
}

*func gettingComponents~Test() {
    ecs: Ecs;

    entity := ecs'entity();
    ecs @= (entity, Data1{10, 20});
    ecs @= (entity, Data2{weight=50.0});

    x : Data1 = ecs[entity, Data1];
    y : Data2 = ecs[entity, Data2];

    (equal) x.x, 10;
    (equal) y.weight, 50.0;
}

*func views~Test() {
    ecs: Ecs;
    #view := edb'view();
    #ecs @= (view, Data1);
    #ecs @= (view, Data2);

    #for (entity in edb'entities(view), data1 in edb'data(view, Data1)) {
    #    # ...
    #}
}
